import{r as a,u as O,c as E,o as j,a as F,b as M,d as f,e as P,f as I,g as L,t as V,Q as N,h as Q,W as $,i as p}from"./index-DKlMtWrI.js";const U={class:"p-4"},q={class:"text-xl font-bold text-green-600 mb-4"},D={class:"mt-6 text-right"},H=["disabled"],G={__name:"ShareView",setup(z){const C=O(),i=a(C.query.filename||"all.json"),u=a(i.value),h=a(""),b=a(""),y=a(""),g=a(""),_=a(""),n=a({}),x=a([]),c=a(!1),S=a(750),r=a(0),d=a([60,60,60,60,100,60,50,50,60,40,60,60,90,90]),v=a([]),k=a(!0),R=a(""),m=E(()=>x.value.filter(t=>t.checked)),T=E(()=>Object.fromEntries(v.value.map(({id:t})=>[t,n.value[t]]).filter(([t,e])=>e==null?void 0:e.isEnabled))),W=t=>["一字型","L","M","中島","側落腳","倒包","假腳或門檻","高背"].find(s=>t.startsWith(s))||"一字型";j(async()=>{try{const e=(await F.get("https://junchengstone.synology.me/accapi/?action=load",{params:{filename:i.value}})).data.content;h.value=e.customer||"",b.value=e.tel||"",y.value=e.fax||"",g.value=e.contacter||"",_.value=e.add||"",n.value=e.results||{},x.value=e.itemList||[],c.value=e.isSep||!1,S.value=e.sepPrice||750,r.value=Object.values(n.value).reduce((s,o)=>s+(parseFloat(c.value?o==null?void 0:o.subtotal2:o==null?void 0:o.subtotal)||0),0)+m.value.reduce((s,o)=>s+o.amount*o.price,0),d.value=e.localColumnWidths||d.value,e.cardOrderList?v.value=e.cardOrderList.map(s=>({...s,isEnabled:s.isEnabled!==!1})):v.value=Object.keys(e.results||{}).map(s=>({id:s,type:W(s),isEnabled:!0})),k.value=!1}catch{R.value="載入分享資料失敗",k.value=!1}});const B=async()=>{if(!u.value){alert("請先儲存或選擇要分享的檔案");return}const t=`${window.location.origin}/accn/share?${encodeURIComponent(u.value)}`;try{await navigator.clipboard.writeText(t),w(`分享連結已複製到剪貼簿：
${t}`)}catch{w(`無法複製分享連結，請手動複製以下連結：
`+t)}};if(!document.getElementById("notification-container")){const t=document.createElement("div");t.id="notification-container",document.body.appendChild(t)}function w(t,e="info",s=3e3){const o=document.getElementById("notification-container"),l=document.createElement("div");l.classList.add("notification"),l.classList.add(e),l.textContent=t,o.appendChild(l),setTimeout(()=>{l.classList.add("fade-out"),setTimeout(()=>{o.removeChild(l)},300)},s)}return(t,e)=>(p(),M("div",U,[f("h1",q,"報價單預覽："+V(i.value),1),P(N,{customer:h.value,tel:b.value,fax:y.value,contacter:g.value,add:_.value},null,8,["customer","tel","fax","contacter","add"]),c.value?L("",!0):(p(),I(Q,{key:0,filteredResults:T.value,filteredItems:m.value,totalSubtotal:r.value,columnWidths:d.value},null,8,["filteredResults","filteredItems","totalSubtotal","columnWidths"])),c.value?(p(),I($,{key:1,sepPrice:S.value,filteredResults:n.value,filteredItems:m.value,totalSubtotal2:r.value},null,8,["sepPrice","filteredResults","filteredItems","totalSubtotal2"])):L("",!0),f("div",D,[f("button",{onClick:B,class:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700",disabled:!u.value}," 複製分享連結 ",8,H)])]))}};export{G as default};
